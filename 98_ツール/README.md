# 開発ツール

このディレクトリには、Kakeibonプロジェクトの開発を効率化するツールが含まれています。

## 📋 利用可能なツール

### 1. start-dev.sh - 開発環境一括起動スクリプト

バックエンド（FastAPI）とフロントエンド（Vite）の両方を1つのターミナルで起動するスクリプトです。

#### 機能

- バックエンドとフロントエンドを同時起動
- プロセス監視（異常終了時に自動検知）
- ログのローテーション機能
- グレースフルシャットダウン対応
- ポート使用状況の事前チェック

#### 使用方法

```bash
# プロジェクトルートから実行
./doc/98_ツール/start-dev.sh
```

または、実行権限を付与して直接実行：

```bash
chmod +x doc/98_ツール/start-dev.sh
doc/98_ツール/start-dev.sh
```

#### 起動後のアクセス先

- **フロントエンド**: http://localhost:5173
- **バックエンドAPI**: http://localhost:8000
- **API ドキュメント**: http://localhost:8000/docs

#### 停止方法

起動したターミナルで `Ctrl+C` を押すと、両方のサーバーがグレースフルシャットダウンされます。

#### ログファイル

- バックエンド: `.dev/backend.log`
- フロントエンド: `.dev/frontend.log`

ログをリアルタイムで確認：

```bash
# バックエンドのログ
tail -f .dev/backend.log

# フロントエンドのログ
tail -f .dev/frontend.log
```

### 2. stop-dev.sh - 開発環境停止スクリプト

別のターミナルから起動中の開発サーバーを停止するスクリプトです。

#### 使用方法

```bash
# プロジェクトルートから実行
./doc/98_ツール/stop-dev.sh
```

または：

```bash
chmod +x doc/98_ツール/stop-dev.sh
doc/98_ツール/stop-dev.sh
```

#### 動作

- バックエンドとフロントエンドのプロセスをグレースフルシャットダウン
- PIDファイルの自動クリーンアップ
- タイムアウト時は強制終了

## 🔧 前提条件

### 必須ツール

- **uv**: Pythonパッケージマネージャー
- **npm**: Node.jsパッケージマネージャー
- **PostgreSQL**: データベース（起動済みであること）

### 環境設定

起動スクリプトを実行する前に、以下の設定が完了していることを確認してください：

1. **バックエンドの環境変数設定** (`backend/.env`)
2. **フロントエンドの環境変数設定** (`frontend/.env`)
3. **データベースマイグレーション実行済み**
4. **フロントエンドの依存関係インストール済み** (`npm install`)

詳細は [セットアップ手順書](../01_設計資料/SETUP.md) を参照してください。

## 📝 トラブルシューティング

### ポートが既に使用されている

**症状**:
```
[ERROR] Port 8000 is already in use.
```

**解決方法**:
```bash
# ポートを使用しているプロセスを確認
lsof -i :8000

# プロセスを終了
kill -9 <PID>
```

### スクリプトの実行権限がない

**症状**:
```
Permission denied
```

**解決方法**:
```bash
# 実行権限を付与
chmod +x doc/98_ツール/start-dev.sh
chmod +x doc/98_ツール/stop-dev.sh
```

### バックエンドまたはフロントエンドが起動しない

**確認項目**:
1. PostgreSQLが起動しているか
2. `.env`ファイルが正しく設定されているか
3. 依存関係がインストールされているか
4. ログファイルでエラーメッセージを確認

```bash
# ログを確認
cat .dev/backend.log
cat .dev/frontend.log
```

### PIDファイルが残っている

**症状**:
スクリプト実行時に古いPIDファイルの警告が表示される

**解決方法**:
スクリプトが自動的に古いPIDファイルをクリーンアップしますが、手動で削除することもできます：

```bash
rm -f .dev/backend.pid .dev/frontend.pid
```

## 💡 開発のヒント

### 手動起動との比較

**start-dev.shを使用する場合**:
- ✅ 1つのターミナルで完結
- ✅ 自動的なプロセス監視
- ✅ ログファイルに出力が保存される
- ✅ グレースフルシャットダウン保証

**手動起動（2つのターミナル）**:
- ✅ リアルタイムでログが見える
- ✅ 個別に再起動可能
- ✅ デバッグ時に柔軟

どちらの方法も有効です。作業スタイルに応じて選択してください。

### 開発フロー推奨

1. **初回起動時**: 手動起動で動作確認
2. **日常的な開発**: `start-dev.sh`で効率化
3. **デバッグ時**: 手動起動で詳細確認

## 🔗 関連ドキュメント

- [セットアップ手順書](../01_設計資料/SETUP.md) - 初期セットアップ方法
- [アーキテクチャ概要](../01_設計資料/ARCHITECTURE.md) - システム構成
- [環境情報](../01_設計資料/ENVIRONMENT.md) - 開発環境の詳細
